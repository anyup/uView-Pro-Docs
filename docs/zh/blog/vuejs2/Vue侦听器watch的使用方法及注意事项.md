---
title: 详解 Vue 中 watch 的使用方法及注意事项
---

# 详解 Vue 中 watch 的使用方法及注意事项

## 前言

Vue 的 Watch 是一个非常有用的功能，它能够监听 Vue 实例数据的变化并执行相应的操作。本篇文章将详细介绍 Vue Watch 的使用方法和注意事项，让你能够充分利用 Watch 来解决 Vue 开发中的各种问题。

## 1. Watch 是什么？

### 1.1 Watch 的作用和优势

Watch 是 Vue 中监视数据变化的一种方法，它允许开发者监听特定数据的变化并执行相应的操作。Watch 的作用和优势如下：

1. **监听数据变化**：Watch 能够监听 Vue 实例中数据的变化，当数据发生改变时自动执行相应的回调函数。

2. **异步操作**：与 Computed 不同，Watch 可以执行异步操作。这对于需要发送网络请求或执行复杂的计算的场景非常有用。

3. **数据联动**：当一个数据发生变化时，有时需要同时更新其他相关的数据。Watch 提供了一种简洁的方式来实现数据之间的联动。

4. **更精确的控制**：相比于 Computed，Watch 能够更精确地控制到底哪些数据需要监听，以及何时以及如何触发相应的操作。

5. **应用场景广泛**：Watch 可以应用于各种场景，包括表单验证、异步操作、数据统计和监控等，非常灵活。

Vue 的 Watch 功能为开发者提供了一种方便、灵活、可靠的处理数据变化的方法，能够更好地满足复杂应用的需求，并提升开发效率。

### 1.2 Watch 的工作原理

想要更好的理解 Watch，必须要理解 Watch 是如何工作的，它的工作原理有几个重要的关键点如下：

1. **Watch 对象的定义**：在 Vue 组件实例中，我们可以通过在`watch`选项中定义一个对象来创建 Watch 监听器。这个对象中可以包含多个键值对，其中键是要监听的数据属性的名称，值是处理数据变化的回调函数。

2. **Watch 的注册**：当 Vue 组件实例创建时，Watch 对象会被注册并与组件实例关联起来。Vue 会遍历 Watch 对象，并为每个键值对创建一个 Watcher 实例。

3. **Watcher 实例的创建**：Watcher 实例是 Watch 的核心，它负责监听和响应数据变化。Watcher 实例在 Watch 对象的键值对中创建，并与要监听的数据属性进行关联。

4. **数据的变化检测**：当被 Watch 监听的数据发生变化时，Vue 会触发数据的变化检测机制。这个机制会比较新旧值，如果发现变化，就会通知相关的 Watcher 实例。

5. **Watcher 的回调执行**：一旦 Watcher 实例接收到变化通知，它将调用相应的回调函数。这个回调函数可以是用户自定义的，用于实现数据变化后的特定操作。

Vue 的 Watch 工作原理是通过 Watcher 实例来监听数据的变化，一旦数据发生变化，Watcher 就会执行相应的回调函数。这种机制能够让开发者以声明式的方式来处理数据的变化，使代码更加清晰和可读。同时，Vue 的响应式系统能够高效地追踪数据的变化并自动更新视图，从而提升应用性能和开发效率。

### 1.3 Watch 和 Computed 的区别

Vue 中的计算属性（Computed）也是 Vue 实例中非常重要的一个特性，用于对 Vue 实例的数据进行动态计算，且具有缓存机制。想要详细了解的可以参考我之前的文章，本文不作过多的赘述，只总结一下 Watch 和 Computed 的使用区别。

了解 Computed 请点击：[深入浅出 Vue 计算属性 ( computed ) 的使用与优化](https://juejin.cn/post/7291936022882402356)

Watch 和 Computed 是 Vue 中两种用于处理数据变化的方法，它们之间有以下几个区别：

1. **用法不同**：Watch 使用`watch`选项来定义一个观察者对象，监听某个数据的变化，当数据发生变化时执行相应的回调函数；而 Computed 使用`computed`选项来定义一个计算属性，根据依赖的数据动态计算得到一个新的值。

2. **监听方式不同**：Watch 可以监听任意数据的变化，甚至是嵌套对象的属性；而 Computed 只能依赖已经存在的响应式数据，它会根据数据的变化自动更新计算得到的值。

3. **响应方式不同**：Watch 的回调函数是在数据变化后执行的，可以执行异步操作；而 Computed 的计算属性是在依赖的数据变化时自动更新的，对外表现为一个缓存值，只有当依赖的数据发生变化时才会重计算。

4. **使用场景不同**：Watch 适用于需要在数据变化时执行异步操作、执行复杂逻辑的场景，例如监听表单输入、发起网络请求等；而 Computed 适用于需要根据已有数据计算得到一个新的值的场景，例如对数据进行过滤、格式化等操作。

5. **计算结果的缓存**：Computed 具有缓存功能，当依赖的数据没有发生变化时，直接返回上一次的计算结果，避免重复计算；而 Watch 没有缓存功能，每当被监听的数据发生变化时，都会执行回调函数。

> **总结**：Watch 和 Computed 在处理数据变化时有着不同的应用场景和使用方式。Watch 适用于处理异步操作、执行复杂逻辑等场景，而 Computed 适用于对已有数据进行计算生成新值的场景，且具有缓存功能。开发者在根据实际需求选择时，需要考虑数据的变化频率、计算的复杂程度等因素。

## 2. Watch 的基本使用方法

### 2.1 定义 Watch

Watch 的基本使用方法步骤如下：

1. 在 Vue 组件的`watch`选项中定义一个观察者对象，可以是一个简单的对象或者一个计算属性名称的数组。

2. 观察者对象的键是要监听的数据属性的名称，值是一个回调函数，用于处理数据变化后的操作。

3. 在回调函数中，可以接收两个参数：

   - newVal: 变化后的新值
   - oldVal: 变化前的旧值

4. 在回调函数中实现特定的逻辑，例如发送请求、更新其他数据等。

通过以上步骤，就可以在 Vue 组件中使用 Watch 来监听指定数据的变化，并在变化后执行相应的操作。可以在`watch`选项中定义多个观察者对象，以监听多个数据属性的变化，可以实现监听单个、多个、对象和数组等数据的变化，并分别指定不同的回调函数来处理不同的数据变化。

### 2.1 监听单个数据

```javascript
watch: {
  // 监听名为"foo"的数据属性
  foo(newVal, oldVal) {
    // 处理数据变化后的操作
    console.log('foo属性发生变化了，新值为:', newVal, '旧值为:', oldVal);

    // 可以在这里执行其他操作，例如发送请求、更新其他数据等
  }
}
```

通过在`watch`选项中定义一个观察者对象，可以监听单个数据属性的变化。回调函数中可以接收到变化后的新值和变化前的旧值。

### 2.3 监听多个数据

```javascript
watch: {
  // 监听名为"foo"和"bar"的数据属性
  foo(newVal, oldVal) {
    // 处理foo属性变化后的操作
  },
  bar(newVal, oldVal) {
    // 处理bar属性变化后的操作
  }
}
```

通过在`watch`选项中定义多个观察者对象，可以同时监听多个数据属性的变化。每个观察者对象都对应一个属性的名称和回调函数。

### 2.4 监听对象属性

```javascript
watch: {
  // 监听整个对象的变化
  obj: {
    handler(newVal, oldVal) {
      // 处理obj属性变化后的操作
    },
    deep: true // 深度监听
  }
  // 监听对象属性"obj.foo"的变化
  'obj.foo': {
    handler(newVal, oldVal) {
      // 处理obj.foo属性变化后的操作
    },
    deep: true // 深度监听
  }
}
```

通过在`watch`选项中定义观察者对象时，可以使用点语法监听对象属性的变化。可以设置`deep`选项为`true`来深度监听对象的变化，即使对象属性的值发生变化，也会触发回调函数。

### 2.5 监听数组元素

```javascript
watch: {
  // 监听数组元素的变化
  arr: {
    handler(newVal, oldVal) {
      // 处理arr数组的变化
    },
    deep: true // 深度监听
  }
}
```

通过在`watch`选项中定义观察者对象时，可以使用数组监听数组元素的变化。同样，可以设置`deep`选项为`true`来深度监听数组的变化，即使数组元素的值发生变化，也会触发回调函数。

> 通过以上的分析，可以根据需要在 Vue 的`watch`选项中监听单个或多个数据属性的变化，并根据回调函数处理相应的操作。同时，可以使用点语法监听对象属性的变化，以及设置`deep`选项来深度监听对象和数组的变化。

## 3. Watch 的高级用法

### 3.1 深度监听数据的变化

在 Vue 中，深度监听数据的变化意味着不仅监听对象或数组本身的变化，还监听它们内部属性或元素的变化。

当将`deep`选项设置为`true`时，Vue 会递归遍历对象的所有属性或数组的所有元素，并为每个属性或元素都创建一个深度观察者。这样，无论是对象的某个属性还是数组的某个元素发生变化，都能触发相应的回调函数。

使用深度监听来监听对象属性的变化如下所示：

```javascript
watch: {
  'obj.foo': {
    handler(newVal, oldVal) {
      console.log('obj.foo属性发生变化了，新值为:', newVal, '旧值为:', oldVal);
    },
    deep: true // 深度监听
  }
}
```

在上述示例中，`obj`是一个对象，`foo`是它的一个属性。当`obj`或`foo`发生变化时，都能触发深度观察者的回调函数。

因此，通过在 Vue 的`watch`选项中将`deep`选项设置为`true`，可以实现对对象属性或数组元素的深度监听，从而捕捉到它们内部值的变化。

> **注意**：深度监听会带来一些**性能开销**，因为它需要递归遍历对象或数组的所有属性或元素。因此，只在需要深度监听的情况下使用，以避免不必要的开销。
>
> 还需要特别注意的是，深度监听仅适用于**对象和数组**，对于基本类型的数据如字符串、数字等是不起作用的。

### 3.2 立即执行 Watch 回调函数

在 Vue 中，watch 选项的回调函数默认是在被监听的数据发生变化后异步执行的，即在下一次事件循环中执行。

然而，有时我们可能需要立即响应数据变化，并在变化发生后立即执行回调函数。为了实现这一需求，Vue 提供了`immediate`选项。

当在 watch 选项中设置`immediate: true`时，Vue 会在监听开始之初立即执行回调函数，无论数据是否已经发生变化。

使用`immediate`选项来实现立即执行 watch 回调函数的效果如下所示：

```javascript
watch: {
  foo: {
    handler(newVal, oldVal) {
      console.log('foo属性发生变化了，新值为:', newVal, '旧值为:', oldVal);
    },
    immediate: true // 立即执行
  }
}
```

在上述示例中，当 Vue 实例创建时，会立即执行一次`foo`属性的 watch 回调函数，无论`foo`的值是否已经发生变化。随后，如果`foo`发生变化，Vue 会在下一次事件循环中再次执行 watch 回调函数。

总之，通过在 Vue 的 watch 选项中设置`immediate: true`，可以立即执行 watch 回调函数，不等待数据的真正变化。这在某些情况下可以用于立即响应数据变化并执行相关操作的需求。

> **注意**：当设置`immediate: true`时，回调函数会在监听开始时立即执行一次，并且不会等待侦听的数据属性的真正变化。这意味着你可能无法获得先前的值，因为此时回调函数仍然是在数据变化之前执行的。

## 总结

在本篇文章中，我们详细介绍了 Vue 中 watch 选项的基本使用方法。通过 watch 选项，我们可以监听数据的变化，并在变化发生时执行相应的操作。

其次，我们有重点的学习到了 Watch 的几个高级用法，了解了如何使用深度监听 `deep` 来递归监听对象内部属性的变化，以及如何使用 `immediate` 选项在初始加载时立即执行回调函数。

相信通过本文的学习，你已经了解了 Vue 中 watch 选项的详细使用方法，可以在开发 Vue 应用时更加灵活和高效地处理数据的变化了。

<ArticleFooter link="https://juejin.cn/post/7293151700867956755" />
